<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!-- base mybatis file for sql defined by self  -->
<mapper namespace="com.yl.work.mapper.ThsConceptEverydayMapper">
    <select id="collectOnedayHotPoints" resultType="com.yl.work.dto.HotConceptBeforeLastDto">
        select distinct hangye,hangyezhishu,zhangdiefu,liuruzijin,
            liuchuzijin,jiner,datekey,paihangIndex,dayIndex,mainshare,
            mainshareup,
          1 as upOrDown
        from `ths_concept_everyday` where dayIndex = #{dayIndex} order by id asc limit 30
    </select>

    <select id="maxDayIndex" resultType="int">
        select max(dayIndex) from ths_concept_everyday
    </select>

    <select id="searchNewAddConcept">
        select t1.* from ths_concept_everyday as t1
        left join (
            select * from ths_concept_everyday where dayIndex = #{lastDayIndex}
        )as t2
        on t1.hangye = t2.hangye
        where t1.dayIndex = #{todayDayIndex}
        and t2.datekey is null
    </select>

    <select id="selectHangYePaiHang" resultType="string">
        <![CDATA[
        select hangye from ths_concept_everyday
        where dayIndex > #{dayIndexFrom} and paihangIndex <= #{paihangLimit}
        group by `hangye`
        order by count(id) desc,
        sum(id) asc
        ]]>
    </select>

    <select id="selectHangYeDetail" resultType="com.yl.work.entity.ThsConceptEverydayEntity">
        <![CDATA[
          select * from ths_concept_everyday
          where dayIndex > #{newDayIndexFrom}
        ]]>
          and hangye in
          <foreach collection="hangyeList" item="item" open="(" separator="," close=")">
            #{item}
          </foreach>
    </select>

    <!-- 更新排行 -->
    <!--<update id="updatePaiHang">-->
        <!--update ths_concept_everyday t1,(-->
            <!--select min(id) as minId,dayIndex from ths_concept_everyday group by dayIndex-->
        <!--)t2-->
        <!--set t1.paihangIndex = (t1.id - t2.minId + 1)-->
        <!--where t1.dayIndex = t2.dayIndex-->
    <!--</update>-->

    <select id="showAllHangYe" resultType="string">
        select hangye from ths_concept_everyday where dayIndex = #{maxDayIndex}
    </select>

</mapper>
